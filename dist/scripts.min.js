let pokemonRepository = (function () {
  let e = [],
    t = document.querySelector(".pokemon-list"),
    n = document.querySelector(".search"),
    i = document.querySelector(".modal-dialog");
  function a(e) {
    let t = document.createElement("div");
    t.classList.add("text-center");
    let n = document.createElement("div");
    n.classList.add("spinner-border"), n.setAttribute("role", "status");
    let i = document.createElement("span");
    i.classList.add("sr-only"),
      (i.innerText = "Loading..."),
      n.appendChild(i),
      t.appendChild(n),
      e.appendChild(t);
  }
  function o(e) {
    e.removeChild(e.lastChild);
  }
  function r(t) {
    "object" == typeof t && Object.keys(t).includes("detailsUrl")
      ? e.push(t)
      : console.error(
          "Pok\xe9mon has to be added using this format: {name:, detailsUrl:}"
        );
  }
  function l() {
    t.innerHTML = "";
  }
  function s() {
    i.classList.add("hidden");
  }
  function d(e) {
    let n = document.createElement("p");
    n.classList.add("error-message"),
      n.classList.add("col-6"),
      (n.innerText = e),
      t.appendChild(n);
  }
  function c() {
    return e;
  }
  function p(e) {
    u(e).then(function () {
      let n = document.createElement("li");
      n.classList.add("col");
      let i = document.createElement("button"),
        a = document.createElement("h2");
      i.appendChild(a),
        (a.innerText = e.name.charAt(0).toUpperCase() + e.name.slice(1)),
        i.classList.add("pokemon-button"),
        i.setAttribute("data-toggle", "modal"),
        i.setAttribute("data-target", ".modal");
      let o = document.createElement("img");
      (o.src = e.frontImageUrl),
        i.appendChild(o),
        n.appendChild(i),
        t.appendChild(n),
        i.addEventListener("click", function () {
          h(e);
        });
    });
  }
  function m(t) {
    return e.filter(function (e) {
      let n = e.name.toLowerCase(),
        i = t.toLowerCase();
      return n.startsWith(i);
    });
  }
  function u(e) {
    let t = document.querySelector(".modal-body");
    return (
      a(t),
      fetch(e.detailsUrl)
        .then(function (e) {
          return e.json();
        })
        .then(function (n) {
          o(t),
            (e.frontImageUrl = n.sprites.front_default),
            (e.backImageUrl = n.sprites.back_default),
            (e.height = n.height);
          let i = [];
          n.types.forEach(function (e) {
            i.push(e.type.name);
          }),
            (e.types = i.join(", "));
          let a = [];
          n.abilities.forEach(function (e) {
            a.push(e.ability.name);
          }),
            (e.abilities = a.join(", "));
        })
        .catch(function (e) {
          o(t), console.error(e);
        })
    );
  }
  function h(e) {
    u(e).then(function () {
      let t = document.querySelector(".modal-title"),
        n = document.querySelector(".modal-body");
      (t.innerHTML = ""), (n.innerHTML = "");
      document.querySelector(".modal-title").innerText =
        e.name.charAt(0).toUpperCase() + e.name.slice(1);
      let i = document.createElement("img");
      i.classList.add("modal-img"), (i.src = e.frontImageUrl);
      let a = document.createElement("img");
      a.classList.add("modal-img"), (a.src = e.backImageUrl);
      let o = document.createElement("div");
      o.classList.add("modal-text");
      let r = document.createElement("p");
      r.innerText = "Height: " + e.height / 10 + " m";
      let l = document.createElement("p");
      l.innerText = "Types: " + e.types;
      let s = document.createElement("p");
      (s.innerText = "Abilities: " + e.abilities),
        n.appendChild(i),
        n.appendChild(a),
        n.appendChild(o),
        o.appendChild(r),
        o.appendChild(l),
        o.appendChild(s);
    });
  }
  return (
    n.addEventListener("input", function () {
      let e = m(n.value);
      l(),
        0 === e.length
          ? d("Sorry. There are no Pok\xe9mon matching your search criteria.")
          : e.forEach(p);
    }),
    window.addEventListener("keydown", function (e) {
      "Escape" === e.key && s();
    }),
    {
      showLoadingSpinner: a,
      hideLoadingSpinner: o,
      add: r,
      removeList: l,
      hideModal: s,
      showErrorMessage: d,
      loadList: function e() {
        let t = document.querySelector(".main");
        return (
          a(t),
          fetch("https://pokeapi.co/api/v2/pokemon/?limit=200")
            .then(function (e) {
              return e.json();
            })
            .then(function (e) {
              o(t),
                (pokemonArray = e.results).forEach(function (e) {
                  r({ name: e.name, detailsUrl: e.url });
                });
            })
            .catch(function (e) {
              o(t),
                l(),
                s(),
                d(
                  "There don't seem to be any Pok\xe9mon around. If you are not offline, try again later."
                ),
                console.error(e);
            })
        );
      },
      getAll: c,
      addListPokemon: p,
      filterPokemons: m,
      loadDetails: u,
      showDetails: h,
    }
  );
})();
pokemonRepository.loadList().then(function () {
  pokemonRepository.getAll().forEach(function e(t) {
    pokemonRepository.addListPokemon(t);
  });
});
